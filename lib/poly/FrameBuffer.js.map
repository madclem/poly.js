{"version":3,"sources":["../../src/poly/FrameBuffer.js"],"names":["FrameBuffer","width","height","texture","gl","POLY","textures","framebuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","createTexture","gltexture","Texture","push","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","LINEAR_MIPMAP_NEAREST","generateMipmap","texImage2D","RGBA","UNSIGNED_BYTE","renderBufferDepth","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","DEPTH_COMPONENT16","framebufferTexture2D","COLOR_ATTACHMENT0","framebufferRenderbuffer","DEPTH_ATTACHMENT","clean","viewport","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","_texture","canvas","bind"],"mappings":"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","file":"FrameBuffer.js","sourcesContent":["export default class FrameBuffer\r\n{\r\n    constructor(width = 512, height = 512, texture)\r\n    {\r\n\r\n        this.gl = POLY.gl;\r\n        let gl = this.gl;\r\n\r\n        this.width = width;\r\n        this.height = height;\r\n\r\n        /*\r\n         CREATE FRAME BUFFER AND SET UP ALL OF ITS MEMORY\r\n        */\r\n\r\n        this.textures = [];\r\n        // create frame buffer and bind it\r\n        this.framebuffer = gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n\r\n        // create an empty texture which can store the colour values\r\n        this.texture = gl.createTexture();\r\n        this.gltexture = new POLY.Texture(this.texture, true);\r\n        this.textures.push(this.gltexture);\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);\r\n        gl.generateMipmap(gl.TEXTURE_2D);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\r\n\r\n        // create a renderbuffer (buffer associated to a frame buffer object), this one for the depth!\r\n        var renderBufferDepth = gl.createRenderbuffer();\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, renderBufferDepth);\r\n        gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, this.width, this.height);\r\n\r\n        // attach everything to the current frame buffer\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.texture, 0);\r\n        gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, renderBufferDepth);\r\n\r\n\r\n        this.clean();\r\n    }\r\n\r\n    bind()\r\n    {\r\n        let gl = this.gl;\r\n        gl.viewport(0, 0, this.width, this.height);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n    }\r\n\r\n    unbind()\r\n    {\r\n        let gl = this.gl;\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, this.gltexture._texture);\r\n        gl.generateMipmap(gl.TEXTURE_2D);\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n        gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n    }\r\n\r\n    clean()\r\n    {\r\n        let gl = this.gl;\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    }\r\n\r\n    clear()\r\n    {\r\n        this.bind();\r\n\t    this.gl.clear(0,0,0,0);\r\n\t\t// this.unbind();\r\n    }\r\n}\r\n"]}
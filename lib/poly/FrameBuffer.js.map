{"version":3,"sources":["../../src/poly/FrameBuffer.js"],"names":["FrameBuffer","width","height","texture","gl","POLY","floatTextures","getExtension","Error","halfFloat","type","UNSIGNED_BYTE","extHalfFloat","checkExtension","FLOAT","HALF_FLOAT_OES","textures","framebuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","createTexture","gltexture","Texture","push","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","generateMipmap","texImage2D","RGBA","renderBufferDepth","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","DEPTH_COMPONENT16","framebufferTexture2D","COLOR_ATTACHMENT0","framebufferRenderbuffer","DEPTH_ATTACHMENT","clean","viewport","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","_texture","canvas","bind","unbind"],"mappings":"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","file":"FrameBuffer.js","sourcesContent":["import ext from './GLExtensions';\r\n\r\nexport default class FrameBuffer\r\n{\r\n    constructor(width = 512, height = 512, texture)\r\n    {\r\n\r\n        this.gl = POLY.gl;\r\n        let gl = this.gl;\r\n\r\n        this.width = width;\r\n        this.height = height;\r\n\r\n        /*\r\n         CREATE FRAME BUFFER AND SET UP ALL OF ITS MEMORY\r\n        */\r\n\r\n        var floatTextures = ext.getExtension('OES_texture_float');\r\n\r\n        if (!ext.getExtension(\"OES_texture_float\")){\r\n          throw new Error( \"float textures not supported\" );\r\n        }\r\n\r\n        var halfFloat = ext.getExtension(\"OES_texture_half_float\");\r\n        let type = gl.UNSIGNED_BYTE;\r\n        const extHalfFloat = ext.getExtension('OES_texture_half_float');\r\n        ext.getExtension(\"OES_texture_float_linear\");\r\n\r\n        if (ext.checkExtension('OES_texture_float'))\r\n        {\r\n            type = gl.FLOAT;\r\n        }\r\n        else if(extHalfFloat) {\r\n            type = extHalfFloat.HALF_FLOAT_OES;\r\n        }\r\n\r\n            // if (mcgl.GL.isMobile && type === gl.FLOAT && extHalfFloat) {\r\n            //     type = extHalfFloat.HALF_FLOAT_OES;\r\n            // }\r\n\r\n        this.textures = [];\r\n        // create frame buffer and bind it\r\n        this.framebuffer = gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n\r\n        // create an empty texture which can store the colour values\r\n\r\n        this.texture = gl.createTexture();\r\n        this.gltexture = new POLY.Texture(this.texture, true);\r\n        this.textures.push(this.gltexture);\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n        gl.generateMipmap(gl.TEXTURE_2D);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, type, null);\r\n\r\n        // create a renderbuffer (buffer associated to a frame buffer object), this one for the depth!\r\n        var renderBufferDepth = gl.createRenderbuffer();\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, renderBufferDepth);\r\n        gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, this.width, this.height);\r\n\r\n        // attach everything to the current frame buffer\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.texture, 0);\r\n        gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, renderBufferDepth);\r\n\r\n\r\n        this.clean();\r\n    }\r\n\r\n    bind()\r\n    {\r\n        let gl = this.gl;\r\n        gl.viewport(0, 0, this.width, this.height);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n    }\r\n\r\n    unbind()\r\n    {\r\n        let gl = this.gl;\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, this.gltexture._texture);\r\n        gl.generateMipmap(gl.TEXTURE_2D);\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n        gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n    }\r\n\r\n    clean()\r\n    {\r\n        let gl = this.gl;\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n        gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    }\r\n\r\n    clear()\r\n    {\r\n        this.bind();\r\n\t    this.gl.clear(0,0,0,0);\r\n\t\tthis.unbind();\r\n    }\r\n}\r\n"]}
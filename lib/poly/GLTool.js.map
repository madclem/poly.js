{"version":3,"sources":["../../src/poly/GLTool.js"],"names":["_lastMesh","aspectRatio","state","gl","mesh","program","i","_attributes","length","attrib","bindBuffer","ARRAY_BUFFER","buffer","vertexAttribPointer","getAttributeLocation","name","itemSize","FLOAT","indexBuffer","ELEMENT_ARRAY_BUFFER","_bindBuffers","update","setState","drawElements","TRIANGLES","_indices","UNSIGNED_SHORT","drawArrays","_numItems","w","h","POLY","canvas","width","height","viewportWidth","viewportHeight","viewport"],"mappings":";;;;;;;;AAAA;;;;;;;;kBAEe;AAEd,mBACA;AAAA;;AACC,OAAKA,SAAL,GAAiB,IAAjB;AACA,OAAKC,WAAL,GAAmB,CAAnB;AACA,OAAKC,KAAL,GAAa,IAAb;AACA;;AAPa;AAAA;AAAA,uBASTC,EATS,EAUd;AACC,QAAKD,KAAL,GAAa,oBAAUC,EAAV,CAAb;AACA;AAZa;AAAA;AAAA,+BAcDC,IAdC,EAed;AACC,OAAID,KAAKC,KAAKC,OAAL,CAAaF,EAAtB;;AAEA,QAAI,IAAIG,IAAI,CAAZ,EAAeA,IAAIF,KAAKG,WAAL,CAAiBC,MAApC,EAA4CF,GAA5C,EACA;AACC,QAAIG,SAASL,KAAKG,WAAL,CAAiBD,CAAjB,CAAb;AACAH,OAAGO,UAAH,CAAcP,GAAGQ,YAAjB,EAA+BF,OAAOG,MAAtC;AACGT,OAAGU,mBAAH,CAAuBT,KAAKC,OAAL,CAAaS,oBAAb,CAAkCL,OAAOM,IAAzC,CAAvB,EAAuEN,OAAOO,QAA9E,EAAwFb,GAAGc,KAA3F,EAAkG,KAAlG,EAAyG,CAAzG,EAA4G,CAA5G;AACH;;AAED,OAAGb,KAAKc,WAAR,EACA;AACCf,OAAGO,UAAH,CAAcP,GAAGgB,oBAAjB,EAAuCf,KAAKc,WAA5C;AACA;AACD;AA7Ba;AAAA;AAAA,uBA+BTd,IA/BS,EAgCd;AACC,OAAG,KAAKJ,SAAL,KAAmBI,IAAtB,EACA;AACC,SAAKgB,YAAL,CAAkBhB,IAAlB;AACA,SAAKJ,SAAL,GAAiBI,IAAjB;AACA;;AAEDA,QAAKiB,MAAL;AACA,OAAIlB,KAAKC,KAAKC,OAAL,CAAaF,EAAtB;;AAEA,OAAGC,KAAKF,KAAR,EACA;AACC,SAAKA,KAAL,CAAWoB,QAAX,CAAoBlB,KAAKF,KAAzB;AACA;;AAED,OAAGE,KAAKc,WAAR,EACA;AACCf,OAAGoB,YAAH,CAAgBpB,GAAGqB,SAAnB,EAA8BpB,KAAKqB,QAAL,CAAcjB,MAA5C,EAAoDL,GAAGuB,cAAvD,EAAuE,CAAvE;AACA,IAHD,MAKA;AACCvB,OAAGwB,UAAH,CAAcxB,GAAGqB,SAAjB,EAA4B,CAA5B,EAA+BpB,KAAKwB,SAApC;AACA;AACD;AAvDa;AAAA;AAAA,yBAyDPC,CAzDO,EAyDJC,CAzDI,EA0Dd;AACC,OAAI3B,KAAK4B,KAAK5B,EAAd;AACAA,MAAG6B,MAAH,CAAUC,KAAV,GAAkBJ,CAAlB;AACA1B,MAAG6B,MAAH,CAAUE,MAAV,GAAmBJ,CAAnB;;AAEA3B,MAAGgC,aAAH,GAAmBN,CAAnB;AACM1B,MAAGiC,cAAH,GAAoBN,CAApB;AACN3B,MAAGkC,QAAH,CAAY,CAAZ,EAAe,CAAf,EAAkBlC,GAAGgC,aAArB,EAAoChC,GAAGiC,cAAvC;;AAEA,QAAKnC,WAAL,GAAmB4B,IAAEC,CAArB;AACA;AApEa;;AAAA;AAAA,M","file":"GLTool.js","sourcesContent":["import State from './State';\n\nexport default new class GLTool\n{\n\tconstructor()\n\t{\n\t\tthis._lastMesh = null;\n\t\tthis.aspectRatio = 0;\n\t\tthis.state = null;\n\t}\n\n\tinit(gl)\n\t{\n\t\tthis.state = new State(gl);\n\t}\n\n\t_bindBuffers(mesh)\n\t{\n\t\tlet gl = mesh.program.gl;\n\n\t\tfor(let i = 0; i < mesh._attributes.length; i++)\n\t\t{\n\t\t\tlet attrib = mesh._attributes[i];\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, attrib.buffer);\n    \t\tgl.vertexAttribPointer(mesh.program.getAttributeLocation(attrib.name), attrib.itemSize, gl.FLOAT, false, 0, 0);\n\t\t}\n\n\t\tif(mesh.indexBuffer)\n\t\t{\n\t\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, mesh.indexBuffer);\n\t\t}\n\t}\n\n\tdraw(mesh)\n\t{\t\n\t\tif(this._lastMesh !== mesh)\n\t\t{\n\t\t\tthis._bindBuffers(mesh);\n\t\t\tthis._lastMesh = mesh;\n\t\t}\n\n\t\tmesh.update();\n\t\tlet gl = mesh.program.gl;\n\n\t\tif(mesh.state)\n\t\t{\n\t\t\tthis.state.setState(mesh.state);\n\t\t}\n\n\t\tif(mesh.indexBuffer)\n\t\t{\n\t\t\tgl.drawElements(gl.TRIANGLES, mesh._indices.length, gl.UNSIGNED_SHORT, 0);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgl.drawArrays(gl.TRIANGLES, 0, mesh._numItems);\n\t\t}\n\t}\n\n\tresize(w, h)\n\t{\n\t\tlet gl = POLY.gl;\n\t\tgl.canvas.width = w;\n\t\tgl.canvas.height = h;\n\n\t\tgl.viewportWidth = w;\n        gl.viewportHeight = h;\n\t\tgl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);\n\n\t\tthis.aspectRatio = w/h;\n\t}\n}\n"]}
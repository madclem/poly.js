{"version":3,"sources":["../../src/poly/GLTool.js"],"names":["_lastMesh","_lastProgram","aspectRatio","state","enabledVertexAttributes","gl","init","mesh","program","i","_attributes","length","attrib","bindBuffer","ARRAY_BUFFER","buffer","attribLocation","getAttributeLocation","name","vertexAttribPointer","itemSize","FLOAT","indexOf","push","enableVertexAttribArray","ELEMENT_ARRAY_BUFFER","indexBuffer","camera","_camera","uniforms","projectionMatrix","viewMatrix","matrix","modelMatrix","_matrix","_bindBuffers","update","setState","_updateMatrices","drawElements","drawType","_indices","UNSIGNED_SHORT","drawArrays","_numItems","w","h","POLY","canvas","width","height","viewportWidth","viewportHeight","viewport"],"mappings":"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","file":"GLTool.js","sourcesContent":["import State from './State';\nimport GLExtensions from './GLExtensions';\n\nexport default new class GLTool\n{\n\tconstructor()\n\t{\n\t\tthis._lastMesh = null;\n\t\tthis._lastProgram = null;\n\t\tthis.aspectRatio = 0;\n\t\tthis.state = null;\n\t\tthis.enabledVertexAttributes = [];\n\t}\n\n\tinit(gl)\n\t{\n\t\tthis.state = new State(gl);\n\t\tGLExtensions.init();\n\t}\n\n\t_bindBuffers(mesh)\n\t{\n\t\tlet gl = mesh.program.gl;\n\n\t\tfor(let i = 0; i < mesh._attributes.length; i++)\n\t\t{\n\t\t\tlet attrib = mesh._attributes[i];\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, attrib.buffer);\n\t\t\tlet attribLocation = mesh.program.getAttributeLocation(attrib.name);\n\n    \t\tgl.vertexAttribPointer(attribLocation, attrib.itemSize, gl.FLOAT, false, 0, 0);\n\n\t\t\tif(this.enabledVertexAttributes.indexOf(attribLocation) === -1)\n            {\n                this.enabledVertexAttributes.push(attribLocation)\n\t\t\t\tgl.enableVertexAttribArray(attribLocation); // NEVER FORGET THAT LINE (I did...)\n\t\t\t}\n            // }\n\n\t\t}\n\n\t\t// if(mesh.indexBuffer)\n\t\t// {\n\t\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, mesh.indexBuffer);\n\t\t// }\n\t}\n\n\tsetCamera(camera)\n\t{\n\t\tthis._camera = camera;\n\t}\n\n\t_updateMatrices(mesh)\n\t{\n\t\tlet program = mesh.program;\n\t\tprogram.uniforms.projectionMatrix = this._camera.projectionMatrix;\n\t    program.uniforms.viewMatrix = this._camera.matrix;\n\t    program.uniforms.modelMatrix = mesh._matrix;\n\n\t}\n\n\tdraw(mesh)\n\t{\n\t\tif(this._lastMesh !== mesh)\n\t\t{\n\t\t\tthis._bindBuffers(mesh);\n\t\t\tthis._lastMesh = mesh;\n\t\t}\n\n\t\tif(this._lastProgram !== mesh.program)\n\t\t{\n\t\t\tthis._lastProgram = mesh.program;\n\t\t}\n\n\t\tmesh.update();\n\t\tlet gl = mesh.program.gl;\n\n\t\tif(mesh.state)\n\t\t{\n\t\t\tthis.state.setState(mesh.state);\n\n\t\t}\n\n\t\tif(this._camera)\n\t\t{\n\t\t\tthis._updateMatrices(mesh);\n\t\t}\n\n\t\tif(mesh.indexBuffer)\n\t\t{\n\t\t\tgl.drawElements(mesh.drawType, mesh._indices.length, gl.UNSIGNED_SHORT, 0);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgl.drawArrays(mesh.drawType, 0, mesh._numItems);\n\t\t}\n\t}\n\n\tresize(w, h)\n\t{\n\t\tlet gl = POLY.gl;\n\t\tgl.canvas.width = w;\n\t\tgl.canvas.height = h;\n\n\t\tgl.viewportWidth = w;\n        gl.viewportHeight = h;\n\t\tgl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);\n\n\t\tthis.aspectRatio = w/h;\n\t}\n}\n"]}
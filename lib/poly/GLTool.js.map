{"version":3,"sources":["../../src/poly/GLTool.js"],"names":["_lastMesh","_lastProgram","aspectRatio","state","enabledVertexAttributes","gl","mesh","program","i","_attributes","length","attrib","bindBuffer","ARRAY_BUFFER","buffer","attribLocation","getAttributeLocation","name","console","log","itemSize","vertexAttribPointer","FLOAT","push","enableVertexAttribArray","indexBuffer","ELEMENT_ARRAY_BUFFER","_bindBuffers","update","setState","drawElements","drawType","_indices","UNSIGNED_SHORT","drawArrays","_numItems","w","h","POLY","canvas","width","height","viewportWidth","viewportHeight","viewport"],"mappings":";;;;;;;;AAAA;;;;;;;;kBAEe;AAEd,mBACA;AAAA;;AACC,OAAKA,SAAL,GAAiB,IAAjB;AACA,OAAKC,YAAL,GAAoB,IAApB;AACA,OAAKC,WAAL,GAAmB,CAAnB;AACA,OAAKC,KAAL,GAAa,IAAb;AACA,OAAKC,uBAAL,GAA+B,EAA/B;AACA;;AATa;AAAA;AAAA,uBAWTC,EAXS,EAYd;AACC,QAAKF,KAAL,GAAa,oBAAUE,EAAV,CAAb;AACA;AAda;AAAA;AAAA,+BAgBDC,IAhBC,EAiBd;AACC,OAAID,KAAKC,KAAKC,OAAL,CAAaF,EAAtB;;AAEA,QAAI,IAAIG,IAAI,CAAZ,EAAeA,IAAIF,KAAKG,WAAL,CAAiBC,MAApC,EAA4CF,GAA5C,EACA;AACC,QAAIG,SAASL,KAAKG,WAAL,CAAiBD,CAAjB,CAAb;AACAH,OAAGO,UAAH,CAAcP,GAAGQ,YAAjB,EAA+BF,OAAOG,MAAtC;AACA,QAAIC,iBAAiBT,KAAKC,OAAL,CAAaS,oBAAb,CAAkCL,OAAOM,IAAzC,CAArB;;AAEAC,YAAQC,GAAR,CAAYR,MAAZ,EAAoBI,cAApB,EAAoCJ,OAAOS,QAA3C;AACGf,OAAGgB,mBAAH,CAAuBN,cAAvB,EAAuCJ,OAAOS,QAA9C,EAAwDf,GAAGiB,KAA3D,EAAkE,KAAlE,EAAyE,CAAzE,EAA4E,CAA5E;;AAEH;AACS;AACI,SAAKlB,uBAAL,CAA6BmB,IAA7B,CAAkCR,cAAlC;AACAV,OAAGmB,uBAAH,CAA2BT,cAA3B,EAXd,CAW0D;AAChD;AAET;;AAED,OAAGT,KAAKmB,WAAR,EACA;AACA;AACCpB,OAAGO,UAAH,CAAcP,GAAGqB,oBAAjB,EAAuCpB,KAAKmB,WAA5C;AACA;AACD;AA1Ca;AAAA;AAAA,uBA4CTnB,IA5CS,EA6Cd;AACC,OAAG,KAAKN,SAAL,KAAmBM,IAAtB,EACA;AACC,SAAKqB,YAAL,CAAkBrB,IAAlB;AACA,SAAKN,SAAL,GAAiBM,IAAjB;AACA;;AAED,OAAG,KAAKL,YAAL,KAAsBK,KAAKC,OAA9B,EACA;AACC;AACA,SAAKN,YAAL,GAAoBK,KAAKC,OAAzB;AACA;AACDD,QAAKsB,MAAL;AACA,OAAIvB,KAAKC,KAAKC,OAAL,CAAaF,EAAtB;;AAEA,OAAGC,KAAKH,KAAR,EACA;AACC,SAAKA,KAAL,CAAW0B,QAAX,CAAoBvB,KAAKH,KAAzB;AACA;;AAED,OAAGG,KAAKmB,WAAR,EACA;AACCpB,OAAGyB,YAAH,CAAgBxB,KAAKyB,QAArB,EAA+BzB,KAAK0B,QAAL,CAActB,MAA7C,EAAqDL,GAAG4B,cAAxD,EAAwE,CAAxE;AACA,IAHD,MAKA;AACC5B,OAAG6B,UAAH,CAAc5B,KAAKyB,QAAnB,EAA6B,CAA7B,EAAgCzB,KAAK6B,SAArC;AACA;AACD;AAzEa;AAAA;AAAA,yBA2EPC,CA3EO,EA2EJC,CA3EI,EA4Ed;AACC,OAAIhC,KAAKiC,KAAKjC,EAAd;AACAA,MAAGkC,MAAH,CAAUC,KAAV,GAAkBJ,CAAlB;AACA/B,MAAGkC,MAAH,CAAUE,MAAV,GAAmBJ,CAAnB;;AAEAhC,MAAGqC,aAAH,GAAmBN,CAAnB;AACM/B,MAAGsC,cAAH,GAAoBN,CAApB;AACNhC,MAAGuC,QAAH,CAAY,CAAZ,EAAe,CAAf,EAAkBvC,GAAGqC,aAArB,EAAoCrC,GAAGsC,cAAvC;;AAEA,QAAKzC,WAAL,GAAmBkC,IAAEC,CAArB;AACA;AAtFa;;AAAA;AAAA,M","file":"GLTool.js","sourcesContent":["import State from './State';\n\nexport default new class GLTool\n{\n\tconstructor()\n\t{\n\t\tthis._lastMesh = null;\n\t\tthis._lastProgram = null;\n\t\tthis.aspectRatio = 0;\n\t\tthis.state = null;\n\t\tthis.enabledVertexAttributes = [];\n\t}\n\n\tinit(gl)\n\t{\n\t\tthis.state = new State(gl);\n\t}\n\n\t_bindBuffers(mesh)\n\t{\n\t\tlet gl = mesh.program.gl;\n\n\t\tfor(let i = 0; i < mesh._attributes.length; i++)\n\t\t{\n\t\t\tlet attrib = mesh._attributes[i];\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, attrib.buffer);\n\t\t\tlet attribLocation = mesh.program.getAttributeLocation(attrib.name);\n\n\t\t\tconsole.log(attrib, attribLocation, attrib.itemSize);\n    \t\tgl.vertexAttribPointer(attribLocation, attrib.itemSize, gl.FLOAT, false, 0, 0);\n\n\t\t\t// if(this.enabledVertexAttributes.indexOf(attribLocation) === -1)\n            // {\n                this.enabledVertexAttributes.push(attribLocation)\n                gl.enableVertexAttribArray(attribLocation); // NEVER FORGET THAT LINE (I did...)\n            // }\n\n\t\t}\n\n\t\tif(mesh.indexBuffer)\n\t\t{\n\t\t// \t// console.log('here');\n\t\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, mesh.indexBuffer);\n\t\t}\n\t}\n\n\tdraw(mesh)\n\t{\n\t\tif(this._lastMesh !== mesh)\n\t\t{\n\t\t\tthis._bindBuffers(mesh);\n\t\t\tthis._lastMesh = mesh;\n\t\t}\n\n\t\tif(this._lastProgram !== mesh.program)\n\t\t{\n\t\t\t// mesh.program.bind();\n\t\t\tthis._lastProgram = mesh.program;\n\t\t}\n\t\tmesh.update();\n\t\tlet gl = mesh.program.gl;\n\n\t\tif(mesh.state)\n\t\t{\n\t\t\tthis.state.setState(mesh.state);\n\t\t}\n\n\t\tif(mesh.indexBuffer)\n\t\t{\n\t\t\tgl.drawElements(mesh.drawType, mesh._indices.length, gl.UNSIGNED_SHORT, 0);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tgl.drawArrays(mesh.drawType, 0, mesh._numItems);\n\t\t}\n\t}\n\n\tresize(w, h)\n\t{\n\t\tlet gl = POLY.gl;\n\t\tgl.canvas.width = w;\n\t\tgl.canvas.height = h;\n\n\t\tgl.viewportWidth = w;\n        gl.viewportHeight = h;\n\t\tgl.viewport(0, 0, gl.viewportWidth, gl.viewportHeight);\n\n\t\tthis.aspectRatio = w/h;\n\t}\n}\n"]}